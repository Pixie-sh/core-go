package strings

import (
	"fmt"
	"strings"
	"testing"
)

func TestUnescape(t *testing.T) {
	coiso := "%7B%7B%23%3E%20en_EmailTemplate%7D%7D%0A%0A%7B%7B%23*inline%20%22content%22%7D%7D%0A%3Ctr%3E%0A%20%20%20%20%3Ctd%20style%3D%22display%3A%20none%3B%20max-height%3A%200px%3B%20overflow%3A%20hidden%3B%20mso-hide%3A%20all%3B%20font-size%3A%201px%3B%20line-height%3A%201px%3B%20color%3A%20%23ffffff%3B%20opacity%3A%200%3B%22%3E%0A%20%20%20%20%20%20%20%20Reset%20your%20password%20now%20to%20regain%20access%20to%20your%20%20account.%20Click%20the%20button%20below%20to%20proceed.%20If%20you%20didn't%20request%20this%2C%20please%20ignore%20this%20email.%0A%20%20%20%20%3C%2Ftd%3E%0A%3C%2Ftr%3E%0A%3Ctr%3E%0A%20%20%20%20%3Ctd%20style%3D%22padding%3A%2020px%3B%20font-family%3A%20Helvetica%2C%20Arial%2C%20sans-serif%3B%20font-size%3A%2016px%3B%20color%3A%20%23333333%3B%22%3E%0A%20%20%20%20%20%20%20%20%3Cp%20style%3D%22margin%3A%200%200%2016px%3B%22%3EHello%20%7B%7B%20GetUserNameByUserID%20user_id%20%7D%7D%2C%3C%2Fp%3E%0A%20%20%20%20%20%20%20%20%3Cp%20style%3D%22margin%3A%200%200%2016px%3B%22%3EWe%20received%20a%20request%20to%20reset%20your%20password.%20Click%20the%20button%20below%20to%20reset%20it%3A%3C%2Fp%3E%0A%20%20%20%20%3C%2Ftd%3E%0A%3C%2Ftr%3E%0A%3C!--%20BUTTON%20--%3E%0A%3Ctr%3E%0A%20%20%20%20%3Ctd%20align%3D%22center%22%20style%3D%22padding%3A%200%2020px%2030px%2020px%3B%22%3E%0A%20%20%20%20%20%20%20%20%3Ctable%20role%3D%22presentation%22%20border%3D%220%22%20cellspacing%3D%220%22%20cellpadding%3D%220%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Ctr%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctd%20align%3D%22center%22%20bgcolor%3D%22%2313E10F%22%20style%3D%22border-radius%3A%205px%3B%20background-color%3A%20%2313E10F%3B%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ca%20href%3D%22%7B%7BGetWebPartnersPublicURL%7D%7D%2Fauth%2Freset-password%2Fnew%2F%7B%7Botp%7D%7D%22%20target%3D%22_blank%22%20style%3D%22font-size%3A%2016px%3B%20font-family%3A%20Helvetica%2C%20Arial%2C%20sans-serif%3B%20color%3A%20%23000000%3B%20text-decoration%3A%20none%3B%20padding%3A%2012px%2024px%3B%20display%3A%20inline-block%3B%20border%3A%202px%20solid%20%2313E10F%3B%20border-radius%3A%205px%3B%22%3EReset%20Password%3C%2Fa%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Ftd%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Ftr%3E%0A%20%20%20%20%20%20%20%20%3C%2Ftable%3E%0A%20%20%20%20%3C%2Ftd%3E%0A%3C%2Ftr%3E%0A%3C!--%20FALLBACK%20LINK%20--%3E%0A%3Ctr%3E%0A%20%20%20%20%3Ctd%20style%3D%22padding%3A%200%2020px%2020px%2020px%3B%20font-family%3A%20Helvetica%2C%20Arial%2C%20sans-serif%3B%20font-size%3A%2010px%3B%20color%3A%20%23333333%3B%22%3E%0A%20%20%20%20%20%20%20%20%3Cp%20style%3D%22margin%3A%200%200%2016px%3B%22%3EIf%20the%20button%20above%20doesn't%20work%2C%20copy%20and%20paste%20this%20link%20into%20your%20web%20browser%3A%3C%2Fp%3E%0A%20%20%20%20%20%20%20%20%3Cp%20style%3D%22margin%3A%200%3B%20word-break%3A%20break-all%3B%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%7BGetWebPartnersPublicURL%7D%7D%2Fauth%2Freset-password%2Fnew%2F%7B%7Botp%7D%7D%0A%20%20%20%20%20%20%20%20%3C%2Fp%3E%0A%20%20%20%20%20%20%20%20%3Cbr%20%2F%3E%0A%20%20%20%20%20%20%20%20%3Cp%20style%3D%22margin%3A%200%200%2016px%3B%22%3EOr%20use%20this%20the%20code%20directly%3A%3C%2Fp%3E%0A%20%20%20%20%20%20%20%20%3Cp%20style%3D%22margin%3A%200%3B%20word-break%3A%20break-all%3B%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%7Botp%7D%7D%0A%20%20%20%20%20%20%20%20%3C%2Fp%3E%0A%20%20%20%20%3C%2Ftd%3E%0A%3C%2Ftr%3E%0A%7B%7B%2Finline%7D%7D%0A%0A%7B%7B%2Fen_EmailTemplate%7D%7D%0A"

	unescaped, err := Unescape(coiso)
	fmt.Println(unescaped, err)

	cenas := "%3C!DOCTYPE%20html%3E%0A%3Chtml%20lang%3D%22en%22%3E%0A%0A%3Chead%3E%0A%20%20%20%20%3Ctitle%3E%7B%7B%20email_subject%20%7D%7D%20sent%20to%20%7B%7B%20email_to%20%7D%7D%3C%2Ftitle%3E%0A%20%20%20%20%3Cmeta%20charset%3D%22UTF-8%22%3E%0A%20%20%20%20%3Cmeta%20http-equiv%3D%22Content-PayloadType%22%20content%3D%22text%2Fhtml%20charset%3DUTF-8%22%20%2F%3E%0A%3C%2Fhead%3E%0A%0A%3Cbody%20style%3D%22margin%3A%200%3B%20padding%3A%200%3B%20background-color%3A%20%23f4f5f6%3B%22%3E%0A%20%20%20%20%3Ccenter%3E%0A%20%20%20%20%20%20%20%20%3Ctable%20role%3D%22presentation%22%20width%3D%22100%25%22%20border%3D%220%22%20cellspacing%3D%220%22%20cellpadding%3D%220%22%20bgcolor%3D%22%23f4f5f6%22%0A%20%20%20%20%20%20%20%20%20%20%20%20style%3D%22background-color%3A%20%23f4f5f6%3B%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Ctr%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctd%20align%3D%22center%22%20bgcolor%3D%22%23f4f5f6%22%20style%3D%22background-color%3A%20%23f4f5f6%3B%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctable%20role%3D%22presentation%22%20class%3D%22wrapper%22%20width%3D%22100%25%22%20style%3D%22max-width%3A%20600px%3B%22%20border%3D%220%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cellpadding%3D%220%22%20cellspacing%3D%220%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctr%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctd%20align%3D%22center%22%20style%3D%22padding%3A%2020px%200%3B%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22https%3A%2F%2Fcdn.pixie.sh%2Fimages%2Fpixie%2Fpixie.png%22%20alt%3D%22Pixie%20Logo%22%20width%3D%22140%22%20style%3D%22display%3A%20block%3B%20border%3A%200%3B%20text-decoration%3A%20none%3B%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Ftd%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Ftr%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctr%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctd%20align%3D%22center%22%20bgcolor%3D%22%23ffffff%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20style%3D%22padding%3A%200%3B%20background-color%3A%20%23ffffff%3B%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctable%20role%3D%22presentation%22%20width%3D%22100%25%22%20border%3D%220%22%20cellspacing%3D%220%22%20cellpadding%3D%220%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%7B%3E%20content%7D%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctr%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctd%20align%3D%22center%22%20style%3D%22padding%3A%2020px%3B%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cp%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20style%3D%22font-family%3A%20Helvetica%2C%20Arial%2C%20sans-serif%3B%20font-size%3A%2016px%3B%20color%3A%20%239a9ea6%3B%20margin%3A%200%3B%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Warm%20regards%2C%3Cbr%3EThe%20Pixie%20Team%20%F0%9F%92%9A%3C%2Fp%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Ftd%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Ftr%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Ftable%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Ftd%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Ftr%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctr%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctd%20align%3D%22center%22%20style%3D%22padding%3A%2020px%3B%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctable%20role%3D%22presentation%22%20width%3D%22100%25%22%20border%3D%220%22%20cellspacing%3D%220%22%20cellpadding%3D%220%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctr%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctd%20align%3D%22center%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20style%3D%22font-family%3A%20Helvetica%2C%20Arial%2C%20sans-serif%3B%20font-size%3A%2014px%3B%20color%3A%20%239a9ea6%3B%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cp%20style%3D%22margin%3A%200%3B%22%3EPixie%2C%20%7B%7BGetCurrentYear%7D%7D%20%26copy%3B%20Pixie%20B.V.%20The%20Netherlands%3C%2Fp%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Ftd%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Ftr%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Ftable%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Ftd%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Ftr%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Ftable%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Ftd%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Ftr%3E%0A%20%20%20%20%20%20%20%20%3C%2Ftable%3E%0A%20%20%20%20%3C%2Fcenter%3E%0A%0A%20%20%20%20%3Cstyle%20type%3D%22text%2Fcss%22%3E%0A%20%20%20%20%20%20%20%20%40media%20(prefers-color-scheme%3A%20dark)%20%7B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20body%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20table%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20td%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20a%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20color%3A%20%23ffffff%20!important%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20body%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background-color%3A%20%231a1a1a%20!important%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20.wrapper%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background-color%3A%20%231a1a1a%20!important%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20.logo%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20content%3A%20url('https%3A%2F%2Fcdn.pixie.sh%2Fimages%2Fpixie%2Fpixie.png')%20!important%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20td%5Bbgcolor%3D%22%23ffffff%22%5D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background-color%3A%20%232c2c2c%20!important%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20td%5Bstyle%3D%22background-color%3A%20%23ffffff%3B%22%5D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background-color%3A%20%232c2c2c%20!important%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20td%5Bbgcolor%3D%22%23f4f5f6%22%5D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background-color%3A%20%231a1a1a%20!important%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20td%5Bstyle%3D%22background-color%3A%20%23f4f5f6%3B%22%5D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20background-color%3A%20%231a1a1a%20!important%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20a%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20color%3A%20%234eaaff%20!important%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20td%5Bstyle%3D%22color%3A%20%23333333%3B%22%5D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20color%3A%20%23ffffff%20!important%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20p%5Bstyle%3D%22color%3A%20%239a9ea6%3B%22%5D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20color%3A%20%23888888%20!important%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20td%5Bstyle*%3D%22color%3A%20%239a9ea6%3B%22%5D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20color%3A%20%23888888%20!important%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%3C%2Fstyle%3E%0A%3C%2Fbody%3E%0A%0A%3C%2Fhtml%3E"
	unescapedCenas, err := Unescape(cenas)
	fmt.Println(unescapedCenas, err)
}

func TestHasSpaceBetweenWords(t *testing.T) {
	// Test the function
	usernames := []string{".##€  €@", ".##€  jjjj", "jjj .##€  €@", "abc def", "jessica cohen", " noleading", "trailing ", "singleword", "multiple words here"}
	for _, username := range usernames {
		username = strings.TrimSpace(username)
		if MatchRegexp(username, `^[^\s]+(\s+[^\s]+)+$`) {
			fmt.Printf("Expected '%s' to have a space between words \n", username)
		} else {
			fmt.Printf("'%s' does NOT have a space between words.\n", username)
		}
	}
}

func TestStripHTMLTags(t *testing.T) {
	tests := []struct {
		input    string
		expected string
	}{
		{"<p>message</p>", "message"},
		{"<div>Hello <strong>World</strong></div>", "Hello World"},
		{"&lt;p&gt;escaped&lt;/p&gt;", "escaped"},
		{"&amp;special &quot;chars&quot;", "&special \"chars\""},
		{"<span class=\"test\">content</span>", "content"},
		{"Plain text", "Plain text"},
		{"", ""},
		{"<img src=\"test.jpg\" alt=\"image\"/>", ""},
		{"<p>Line 1<br>Line 2</p>", "Line 1Line 2"},
	}

	for _, test := range tests {
		result := StripHTMLTags(test.input)
		if result != test.expected {
			t.Errorf("StripHTMLTags(%q) = %q; want %q", test.input, result, test.expected)
		}
	}
}
